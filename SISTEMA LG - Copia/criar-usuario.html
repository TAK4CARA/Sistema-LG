<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Criar Novo Usu√°rio</title>
<link rel="stylesheet" href="criar-usuario.css">

<!-- PROTE√á√ÉO: SOMENTE ADMIN -->
<script>
const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
if (!usuario || usuario.nivel !== "admin") {
    alert("Acesso restrito!");
    window.location.href = "index.html";
}
</script>

<script src="auth.js"></script>
<script>
exigirAdmin();
</script>

</head>

<body>

<div class="container">
    <h2>Criar Novo Usu√°rio</h2>

    <label>Nome</label>
    <input type="text" id="nome">

    <label>Email</label>
    <input type="email" id="email">

    <label>Senha</label>
    <input type="password" id="senha">

    <label>Confirmar Senha</label>
    <input type="password" id="confirmar">

    <label>N√≠vel de Acesso</label>
    <select id="nivel">
        <option value="usuario">Usu√°rio</option>
        <option value="visualizador">Visualizador</option>
        <option value="admin">Administrador</option>
    </select>

    <button class="btn" onclick="criarUsuario()">Salvar Usu√°rio</button>
    <button class="btn voltar" onclick="window.location.href='index.html'">Voltar</button>
</div>

<script>
// üîê PROTE√á√ÉO DE ACESSO
const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"));

if (!usuarioLogado || usuarioLogado.nivel !== "admin") {
    alert("Acesso restrito ao administrador.");
    window.location.href = "index.html";
}

// üì¶ LISTA DE USU√ÅRIOS
let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];

// ‚ûï CRIAR USU√ÅRIO
function criarUsuario() {
    const nome = document.getElementById("nome").value.trim();
    const email = document.getElementById("email").value.trim();
    const senha = document.getElementById("senha").value;
    const confirmar = document.getElementById("confirmar").value;
    const nivel = document.getElementById("nivel").value;

    if (!nome || !email || !senha || !confirmar) {
        alert("Preencha todos os campos.");
        return;
    }

    if (senha !== confirmar) {
        alert("As senhas n√£o conferem.");
        return;
    }

    if (usuarios.some(u => u.email === email)) {
        alert("Email j√° cadastrado.");
        return;
    }

    const novoUsuario = {
        nome,
        email,
        senha, // ‚ö†Ô∏è Simples (frontend). Backend depois usa hash.
        nivel
    };

    usuarios.push(novoUsuario);
    localStorage.setItem("usuarios", JSON.stringify(usuarios));

    alert("Usu√°rio criado com sucesso!");
    window.location.href = "index.html";
}
</script>

</body>
</html>
